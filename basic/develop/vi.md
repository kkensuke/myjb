# Vi/Vim

macOS の場合、vi コマンドでも vim エディタが起動します
(シンボリックリンクが張られているため)

好みのオプションなどを vimrc というスタートアップファイルに記述しておくと、vim が起動するとき（初期化の際）に記述されたコマンドが実行されます。
Mac の場合、初期状態ではこのファイルは作成されていないので、ユーザのディレクトリ(~/)に .vimrc というファイル名で作成します。
```
$ vim ~/.vimrc
```
引数に指定したファイルが存在しない場合は新規にファイルが作成され、既に存在する場合は指定したファイルが開きます。
vim を起動した直後はノーマルモードになっています。

ノーマルモード（コマンドモード）
文字入力以外の編集作業（文字の削除や置換など）を行うモードです。
vim を起動した直後はノーマルモードになっています。
タイプしたキーがエディタに対するコマンドになります。
文字列の検索やファイルの保存、vim の終了などもノーマルモードで行います。

コマンドラインモード
ウィンドウの下部のステータスラインに1行のコマンドを入力するモードです。
ファイルの保存や文字列の検索、vim の終了などはコマンドラインモードで行います。
: で始まる Ex コマンドや / または ? で始まるパターン検索コマンドなどで使用します。
※ Ex コマンドやパターン検索コマンドは、実行した履歴が保存されるので、後から上下の矢印キーを使って呼び出すことができます。
例えば、Ex コマンドの場合なら、: をタイプした後に上下の矢印キーを使って過去に実行したコマンドを呼び出すことができます。: の後に目的のコマンドの先頭の文字を入力すれば、コマンドを絞り込むことができます。

インサートモード
文字の入力を行うモードです。
インサート（Insert ）は挿入を意味するので挿入モードとも呼ばれます。
ノーマルモードからインサートモードに入るには、i コマンドを実行します（i を押します）。
キーをタイプすると、その文字がカーソルの位置に入力されます。
インサートモードを終了し、ノーマルモードへ移行するには esc を押します。

```
コマンド	説明
:q	終了
:q!	変更を破棄して強制的に終了
:wq	変更を保存して終了
:e!	変更を破棄してファイルを再読み込み（終了しない）
```

ノーマルモードへ戻る
どのモードにいる場合でも esc を押せばノーマルモードに戻ることがます。
場合によっては esc を二回押さなければならないときもあります。
ノーマルモードで esc を押すとビープ音が鳴る

カウンタ
カーソルの移動のコマンドには、カウンタ（繰り返し回数）を指定することができます。
例えば、3文字左に移動するには 3h、4行下に移動するには 4j とタイプすることができます。

ノーマルモードでのカーソル移動
```
コマンド	説明
w	次の単語（word）の先頭に移動
W	次の単語（空白を区切りとした単語 WORD）の先頭に移動
e	単語の最後の文字へ移動
E	（空白を区切りとした）単語の最後の文字へ移動
ge	直前の単語の最後の文字へ移動
gE	直前の（空白を区切りとした）単語の最後の文字へ移動
b	直前の単語の最初の文字へ移動
B	直前の（空白を区切りとした）単語の最初の文字へ移動
0（ゼロ）	行頭に移動
^	行頭に移動
$	行末に移動
f文字	現在行のカーソルの位置より後ろにある指定した文字に移動。; を押すと次の文字へ移動。
F文字	現在行のカーソルの位置より前にある指定した文字に移動。; を押すと次の文字へ移動。
gg	先頭行の行頭に移動
G	最後の行の行頭に移動
行番号G	行番号で指定した行の先頭へ移動
+	一行下の先頭の文字へ移動
-	一行上の先頭の文字へ移動
H	画面上に見えている行の先頭（Home）に移動
M	画面上に見えている行の真ん中（Middle）に移動
L	画面上に見えている行の最後（Last）に移動
%	対応する括弧 ")", "]", "}" に移動
```

ノーマルモードでのスクロール
```
コマンド	説明
CTRL-D （ control + d ）	画面を半分だけ下（Down）にスクロール
CTRL-U （ control + u ）	画面を半分だけ上（Up）にスクロール
CTRL-F （ control + f ）	1 画面分スクロール（Forward）
CTRL-B （ control + b ）	1 画面分逆方向にスクロール（Backward）
```

ノーマルモードでの文字の削除
```
コマンド	説明
x	カーソル位置の文字を削除
X	カーソル位置の前の文字を削除
dh	カーソルの左の文字を削除
dl	カーソル位置の文字を削除
dw	単語の末尾までを削除
dd	カーソル位置の行を削除
dj	カーソル位置の行とその下の行を削除
dk	カーソル位置の行とその上の行を削除
df文字	カーソルの位置から「文字」までを削除
D	カーソル位置から行末までを削除（d$ と同じ）
J	改行文字を削除
```

取り消し（undo）とやり直し(redo)
```
コマンド	説明
u	直前のコマンドを取り消す（undo）
U	行全体へのコマンドの取消し（行を元の状態に戻す）
CTRL-R（ control + r ）	直前の u コマンドを取り消す(redo) → やり直す
```

インサートモードへ移行するコマンド
```
コマンド	説明
i	カーソルの位置に文字を入力
I	現在行の先頭に文字を入力（大文字の i）
a	カーソルの右側に文字を入力
A	現在行の末尾に文字を入力
o	現在行の後に新たな行を挿入して文字を入力
O	現在行の前に新たな行を挿入して文字を入力
```

ファイルを保存するコマンド
```
コマンド	説明
:w	バッファ（変更内容）をファイルに保存
:w ファイル名	指定したファイルにバッファ（変更内容）を保存（別名で保存）
:wq	バッファ（変更内容）をファイルに保存して vim を終了
ZZ	変更を保存して vim を終了（:wq とほぼ同じ？）
変更を破棄して終了するコマンド
コマンド	説明
:q!	変更した内容を保存せず終了
:e!	最後の保存状態に戻す。今開いているバッファのファイルを再読込する
```

検索
ノーマルモードでスラッシュ / をタイプすると、画面左下のステータスラインに / が表示されてカーソルが移動し検索文字を入力する状態になります。

検索履歴
検索履歴は保存されるので、/ をタイプした後に上矢印（↑）または下矢印（↓）キーで検索の履歴を呼び出して、再度利用することができます。
また、/ をタイプした後に文字をタイプして矢印キーを使うことで検索文字を絞り込むことができます。

単語全体を一致させる
"xxxx" で始まる単語だけを探す場合は、/\<xxxx のように 検索文字の前に \< を付けて検索します。
"xxxx" で終わる単語だけを探す場合は、/xxxx\>のように 検索文字の後に \> を付けて検索します。
"xxxx" という単語だけを探す場合は、/\<xxxx\> のように指定します。

文章中の単語の検索
探したい単語の上にカーソルを置いて * をタイプすると、カーソル位置の単語が検索文字列として使われ、その単語が次に現れる位置にカーソルが移動します。# をタイプすると逆方向に検索します。

検索結果のハイライト表示
検索結果をハイライト表示するには、hlsearch オプションを設定します。
ノーマルモードで :set hlsearch とタイプして return を押すと検索にヒットした全ての部分がハイライト表示されます。
このオプションを毎回設定したい場合は、スタートアップファイル（vimrc ）にこのコマンド（set hlsearch）を記述しておくことができます。

検索＆置換
置換はノーマルモードで : をタイプしてコマンドモードに移行し、s/置換対象文字列/置換後文字列/ とタイプして return を押します。(カーソルのある行で最初に見つかった文字列を行う)
```
$ :s/置換対象文字列/置換後文字列/
```
カーソルのある行で見つかった全ての文字列に対して行うには
```
$ :s/置換対象文字列/置換後文字列/g
```

複数行から
複数行から見つかる文字を変更するには、 : の後に行の範囲をカンマで区切って指定します。
g を付けない場合は、行の中の最初に見つかったものだけが置換されます。
:5,10s/old/new/g

確認しながら変更
1つ1つ確認しながら変更するには c を付けます。
:5,10s/old/new/gc

ファイル全体を対象
ファイル全体で見つかるものに対して変更するには、 : の後に % を指定します。
:%s/old/new/g


オペレータとモーション
多くのコマンドはオペレータとモーション で構成されています。
例えば、dw は「単語の末尾までを削除」するコマンドですが、これは削除コマンド（d）のオペレータ d とモーション（移動）の w を続けることで、現在の場所から、モーションコマンドで移動した場所（単語の末尾）までを削除します。
$ コマンドは行末まで移動するので、d$ コマンドならカーソル位置から行末までが削除されます。
f文字 は現在行のカーソルの位置より後ろにある指定した文字に移動します。
dfx とすると、カーソルの位置から現在行の後ろにある「x」までを削除します。

3w コマンドはカーソルを単語3個分移動します。
このため、d3w は3個の単語を削除するコマンドになります。
オペレータとモーションを組み合わせる際は、最初にオペレータコマンドを入力し、次にモーションコマンドを入力します。
d2k は、カーソル位置の行とその上2行（計3行）が削除されます。
d3w と 3dw
d3w も 3dw も単語を3個削除するコマンドで同等です。
* d3w：3つの単語の削除を 1 度だけ実行 → 単語を3個削除
* 3dw：1つの単語の削除を 3 回実行 → 単語を3個削除
例えば、3d2w（2つの単語の削除を3回実行 → 6つの単語を削除）

変更
変更コマンドは、削除コマンドと同じように以下のような形式で指定できます。
c [数値] モーション
但し、削除コマンドとは異なり、実行するとインサートモードに入ります。そのため、続けて文字の挿入も行うことができます。
単語の一部、もしくは全体を変更するには、変更する位置にカーソルを移動して cw とタイプします。続いて変更する文字をタイプします。
インサートモードになっているので、必要に応じて esc を押してノーマルモードに戻ります。
例えば、2つの単語を変更するには、c2w とタイプします。
c は「変更」オペレータで、2w は「2単語移動」を意味し、2単語が削除され、挿入モードに入ります。そして文字をタイプすると結果として変更されます。
以下は変更のコマンドの例です。
```
コマンド	説明
cc	カーソル位置の行を変更
c$	カーソル位置から行末までを変更
c^	カーソル位置から行頭までを変更
C	カーソル位置から行末までを変更（c$）
s	カーソル位置の１文字変更（cl）
S	カーソル位置の行を変更（cc）
```

テキストのコピー（ヤンク）
y オペレータで文字列をバッファにコピーすることができます。
バッファにコピーした文字列は p コマンドでプット（ペースト）できます。
copy の c は既に変更コマンドのオペレータで使用されているため yank（ヤンク）の y がコピーのコマンドに使われています。
y オペレータも d や c オペレータ同様、以下のような形式で指定できます。
y [数値] モーション
例えば、1つの単語をコピーするには yw、2つの単語をコピー（ヤンク）するには y2w とします。
以下はコピーのコマンドの例です。
```
コマンド	説明
yw	単語の末尾までをコピー
yy	カーソル位置の行をコピー
Y	カーソル位置の行をコピー（yy）
y$	カーソル位置から行末までをコピー
y^	カーソル位置から行頭までをコピー
```

